{% load heroicons %}
{% partialdef form %}
    {% with search_url=search_url|default:request.path %}
        <div class="flex items-center">
            <form class="relative bg-transparent"
                  method="get"
                  action="{{ search_url }}"
                  x-init="$watch('search', value => $dispatch('search', value))"
                  x-data="{search: '{{ request.search.value|escapejs }}'}">
                <input type="search"
                       name="{{ request.search.param }}"
                       id="{{ search_id|default:'search' }}"
                       class="w-60 form-input"
                       :class="search ? 'lg:w-96': 'lg:w-80'"
                       autocomplete="off"
                       maxlength="{{ request.search.max_length }}"
                       placeholder="Search Ctrl+K"
                       aria-label="Search Ctrl+K"
                       hx-validate="true"
                       x-model="search"
                       x-ref="search"
                       @keydown.window.ctrl.k.prevent="$el.focus()">
                <div class="flex absolute inset-y-0 right-0 items-center pr-2">
                    {% if clearable and request.search %}
                        <a href="{{ search_url }}"
                           title="Clear Search"
                           aria-label="Clear Search"
                           class="mr-2 text-gray-900 cursor-pointer dark:text-gray-100 focus:outline-hidden focus:shadow-outline">
                            {% heroicon_mini "backspace" title="Clear Search" %}
                        </a>
                    {% else %}
                        <button title="Clear Search"
                                aria-label="Clear Search"
                                type="button"
                                class="mr-2 text-gray-900 cursor-pointer dark:text-gray-100 focus:outline-hidden focus:shadow-outline"
                                x-show="search"
                                x-cloak
                                @click.prevent="search=''; $refs.search.focus()">
                            {% heroicon_mini "backspace" title="Clear Search" %}
                        </button>
                    {% endif %}
                    <button type="submit"
                            title="Search"
                            aria-label="Search"
                            :disabled="!search"
                            class="text-gray-900 cursor-pointer dark:text-gray-100 focus:outline-hidden focus:shadow-outline">
                        {% heroicon_mini "magnifying-glass" title="Search" %}
                    </button>
                </div>
            </form>
        </div>
    {% endwith %}
{% endpartialdef %}
{% partialdef button %}
    <button class="inline-flex items-center btn btn-default"
            tabindex="0"
            role="link"
        {# fmt:off #}
        x-data="{
        url: '{{ search_button_url|escapejs }}',
        search: '{{ request.search.value|escapejs }}',
        process () {
        window.htmx?.process($el);
        },
        get searchUrl() {
        const params = new URLSearchParams();
        params.append('{{ request.search.param }}', this.search);
        return `${this.url}?${params.toString()}`;
        },
        }"{# fmt:on #}
            x-init="process()"
            hx-push-url="true"
            :hx-get="searchUrl"
            :disabled="!search"
            @search.window="search=$event.detail; $nextTick(process);">
        {% heroicon_mini "magnifying-glass" %}
        {{ label }}
    </button>
{% endpartialdef %}
