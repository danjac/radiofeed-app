{% load heroicons static %}
<header class="sticky top-0 z-10 w-full border-b border-zinc-200 bg-white/80 backdrop-blur-lg dark:border-zinc-800 dark:bg-zinc-950/80"
        x-data="{showSidebar: false, showUserDropdown: false, scrolling: false}"
        {# fmt:off #}
        x-init="
                $watch('showSidebar', value => { if (value) showUserDropdown = false; });
                $watch('showUserDropdown', value => { if (value) showSidebar = false; });"
        {# fmt:on #}
        @scroll.window="scrolling = window.pageYOffset > 0"
        @htmx:before-request.window="showSidebar=false; showUserDropdown=false">
    <nav class="flex justify-between items-center p-4">
        {% with site_name=request.site.name %}
            <a class="flex items-center shrink-0"
               {% if user.is_authenticated %}
                   href="{% url 'podcasts:subscriptions' %}"
               {% else %}
                   href="{% url 'index' %}"
                   hx-disable="true"
               {% endif %}
            >
                <img src="{% static 'img/logo.png' %}"
                     alt="{{ site_name }}"
                     height="32"
                     width="32"
                     class="mr-3 w-8 h-8 rounded-xl">
                <span class="inline-flex items-center text-xl font-bold lg:text-2xl"
                      title="{{ site_name }}">
                    {{ site_name }}
                </span>
            </a>
        {% endwith %}
        <ul class="flex items-center space-x-3 xl:space-x-0">
            {% if user.is_authenticated %}
                <li>
                    <nav class="relative" id="user-dropdown">
                        <button id="user-dropdown-btn"
                                tabindex="0"
                                accesskey="u"
                                title="You are logged in as {{ user.username }}"
                                x-cloak
                                @click="showUserDropdown = !showUserDropdown"
                                @click.outside="showUserDropdown=false"
                                @keyup.escape.window="showUserDropdown=false"
                                class="flex items-center p-2 rounded-xl transition-colors cursor-pointer sm:justify-end dark:hover:text-zinc-100 dark:hover:bg-zinc-800 hover:text-zinc-900 hover:bg-zinc-100">
                            {% heroicon_outline "user-circle" size=30 x_show="!showUserDropdown" %}
                            {% heroicon_solid "user-circle" size=30 x_show="showUserDropdown" %}
                        </button>
                        <div class="absolute right-1 z-20 w-64 bg-white rounded-xl border shadow-xl border-zinc-200 dark:bg-zinc-900 dark:border-zinc-700"
                             x-cloak
                             x-show="showUserDropdown"
                             x-transition.scale.origin.top>
                            <ul class="py-3 list-none" aria-labelledby="user-dropdown-btn">
                                <li class="flex flex-wrap items-center py-2 px-4 pb-3 mb-3 break-words border-b text-zinc-700 border-zinc-200 dark:text-zinc-200 dark:border-zinc-700">
                                    Logged in as &nbsp; <strong>{{ user.username }}</strong>
                                </li>
                                <li>
                                    <a href="{% url "users:preferences" %}"
                                       accesskey="s"
                                       class="flex items-center py-2 px-4 font-semibold text-zinc-700 dark:text-zinc-200 dark:hover:bg-zinc-800 hover:bg-zinc-100">
                                        {% heroicon_mini "cog" class="mr-2" %}
                                        Settings
                                    </a>
                                </li>
                                {% if user.is_staff %}
                                    <li>
                                        <a href="{% url "admin:index" %}"
                                           accesskey="a"
                                           target="_blank"
                                           class="flex items-center py-2 px-4 font-semibold text-zinc-700 dark:text-zinc-200 dark:hover:bg-zinc-800 hover:bg-zinc-100">
                                            {% heroicon_mini "wrench-screwdriver" class="mr-2" %}
                                            Site Admin
                                        </a>
                                    </li>
                                {% endif %}
                                <li>
                                    <form class="items-center py-2 px-4 w-full flex-inline dark:hover:bg-zinc-800 hover:bg-zinc-100"
                                          hx-disable="true"
                                          action="{% url "account_logout" %}"
                                          method="post">
                                        {% csrf_token %}
                                        <button accesskey="l"
                                                class="flex items-center w-full font-semibold hover:cursor-pointer text-zinc-700 dark:text-zinc-200">
                                            {% heroicon_mini "arrow-left-start-on-rectangle" class="mr-2" %}
                                            Logout
                                        </button>
                                    </form>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </li>
                <li class="flex items-center xl:hidden">
                    <button class="p-2 rounded-xl transition transform hover:cursor-pointer dark:hover:bg-zinc-800 hover:bg-zinc-100 focus:outline-hidden"
                            aria-label="Show Site Navigation"
                            title="Show Site Navigation"
                            accesskey="m"
                            tabindex="0"
                            x-cloak
                            x-show="!showSidebar"
                            @click="showSidebar=true">
                        {% heroicon_outline "bars-3" size=30 title="Toggle Menu" %}
                    </button>
                    <button class="p-2 rounded-xl transition transform hover:cursor-pointer dark:hover:bg-zinc-800 hover:bg-zinc-100 focus:outline-hidden"
                            aria-label="Hide Site Navigation"
                            title="Hide Site Navigation"
                            accesskey="m"
                            tabindex="0"
                            x-cloak
                            x-show="showSidebar"
                            @click="showSidebar=false"
                            @keyup.escape.window="showSidebar=false">
                        {% heroicon_outline "x-mark" size=30 title="Toggle Menu" %}
                    </button>
                </li>
            {% else %}
                <li>
                    <a href="{% url 'about' %}"
                       aria-label="About this Site"
                       title="About this Site"
                       class="flex items-center p-2 space-x-2 rounded-xl link text-bold dark:hover:bg-zinc-800 hover:bg-zinc-100">
                        {% heroicon_outline "information-circle" size=30 %}
                        <span class="hidden md:inline-block">About</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
    {% if user.is_authenticated %}
        <nav class="absolute left-0 z-50 py-6 px-2 w-full bg-white border-b shadow-xl xl:hidden border-zinc-200 dark:bg-zinc-900 dark:border-zinc-700"
             x-cloak
             x-show.transition="showSidebar"
             x-transition:enter-start="transform opacity-0 scale-95 -translate-y-12 sm:-translate-y-6"
             x-transition:enter="transition ease-out duration-100"
             x-transition:enter-end="transform opacity-100 scale-100 translate-y-0"
             x-transition:leave="transition ease-in duration-100"
             x-transition:leave-start="transform opacity-100 scale-100 translate-y-0"
             x-transition:leave-end="transform opacity-0 scale-95 -translate-y-12 sm:-translate-y-6"
             @click.outside="showSidebar=false">
            {% include "sidebar.html" %}
        </nav>
    {% else %}
        <div class="p-3 font-bold text-center text-white bg-indigo-600">
            <a href="{% url 'account_signup' %}" class="underline">Sign up</a>
            or
            <a href="{% url 'account_login' %}" class="underline">log in</a>
            to follow your favorite podcasts and episodes!
        </div>
    {% endif %}
    <div x-data="{show: false, content: '', dismissable: false}"
         x-cloak
         x-transition
         x-show="show"
         @cta.window="show = true; content = $event.detail.content; dismissable = $event.detail.dismissable;">
        <div class="p-3 font-bold text-center text-white bg-indigo-600 [&_a,&_button]:inline-flex [&_a,&_button]:underline [&_a,&_button]:hover:opacity-75 [&_a,&_button]:cursor-pointer">
            <div class="relative">
                <button @click="show = false"
                        class="absolute top-0 right-0 pl-2 text-white cursor-pointer hover:opacity-75"
                        x-show="dismissable">
                    {% heroicon_mini "x-mark" %}
                </button>
                <div class="pr-6" x-html="content"></div>
            </div>
        </div>
    </div>
</header>
