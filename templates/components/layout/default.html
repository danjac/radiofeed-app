{% load django_htmx static %}
<c-vars title />
    {# djlint: off #}
<!DOCTYPE html>
<html lang="en">
    <c-layout.head :title="title" />
    <body class="mx-auto font-sans antialiased container-xl scroll-smooth"
          hx-boost="true"
          hx-target="#content"
          hx-swap="innerHTML show:window:top"
          hx-indicator="#hx-indicator">
        <div id="hx-indicator"
                 {# fmt:off #}
                 x-data="{width: 0}"
                 x-init="
                    setInterval(() => {
                        if ($el.classList.contains('htmx-request')) {
                            width = width + (Math.random() / 100) + 1;
                            width = width > 30 ? width = -30 : width;
                        } else {
                            width = 0;
                        }
                        $el.style.width = width > 0 ? `${10 + (width * 90)}%` : '0px';
                }, 36);"{# fmt:on #}>
            </div>
        <c-messages />
        <div class="flex flex-col h-screen">
            <div class="grow">
                <c-navbar />
                <div class="flex relative py-6 px-2 mx-auto min-h-screen">
                    {% if user.is_authenticated %}
                        <aside class="hidden w-full xl:block xl:sticky xl:top-24 xl:w-1/6 xl:h-full">
                            <nav>
                                <c-navbar.menu />
                            </nav>
                        </aside>
                    {% endif %}
                    <main class="mx-auto w-full xl:pt-3 xl:w-5/6" id="content" hx-history-elt>
                        {{ slot }}
                    </main>
                </div>
            </div>
            <c-audio-player :audio-log="request.player.audio_log" />
            <c-cookie-banner />
        </div>
        {% if user.is_authenticated %}
            <script src="{% static 'audio-player.js' %}"></script>
        {% endif %}
        {% django_htmx_script %}
        <c-service-worker />
        {{ scripts }}
    </body>
</html>
